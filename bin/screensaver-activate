#!/bin/bash

_dbus_send() {
    local dbus_dest="$1"
    local dbus_path="$2"
    local dbus_msg="$3"

    dbus-send --session --dest="${dbus_dest}" --type=method_call "${dbus_path}" "${dbus_msg}"

    return 0
}

_freedesktop() {
    local action="$1"
    _dbus_send "org.freedesktop.ScreenSaver" "/ScreenSaver" "org.freedesktop.ScreenSaver.${action}"
    return 0
}

_gnome() {
    local action="$1"
    _dbus_send "org.gnome.ScreenSaver" "/org/gnome/ScreenSaver" "org.gnome.ScreenSaver.${action}"
    return 0
}

_screensaver_command() {
    local locker="$1"
    local cmd="$2"
    local args="$3"

    if ! command -v "${locker}" > /dev/null 2>&1 ; then
        return 0
    fi

    "${cmd}" ${args}

    return 0
}

_freedesktop "Lock"
_gnome "Lock"
_screensaver_command "cinnamon-screensaver" "cinnamon-screensaver-command" "--lock"
_screensaver_command "gnome-screensaver"    "gnome-screensaver-command"    "--lock"
_screensaver_command "light-locker"         "light-locker-command"         "--lock"
_screensaver_command "mate-screensaver"     "mate-screensaver-command"     "--lock"
_screensaver_command "xautolock"            "xautolock"                    "-locknow"
_screensaver_command "xscreensaver"         "xscreensaver-command"         "-lock"
