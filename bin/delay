#!/bin/sh
#
# Wait for some time and execute the command given as parameter to this script

# Default delay is two seconds
DELAY="2s"
# Default command is empty
COMMAND=""

USAGE="usage: $0 [-h] [-d NUM[s|m|h|d]] [--] command...
Options
  -d,--delay NUM[smhd]  Execute the command after NUM seconds, minutes,
                        hours or days.  See  man sleep  or  info sleep for
                        more information.  With GNU sleep, floating point
                        numbers are allowed.  Default is \"$DELAY\".
  -h,--help             Show this help"

# Parse paramters...
ARGUMENTS=`getopt -a --name=$0 --longoptions="delay:,help" --options="d:h" -- "$@"` || ARGUMENTS="-h"

eval set -- "$ARGUMENTS"

while true ; do
    case "$1" in
	-d | --delay )
            DELAY=`echo $2 | sed -e 's/,/./g'`
	    shift 2
	;;
	-h | --help )
	    echo "$USAGE"
	    shift
	    exit 1
	;;
	-- )
	    shift
            COMMAND="$@"
	    break
	;;
    esac
done

if [ -z "$COMMAND" ] ; then
    echo "Please specify a command."
    exit 1
fi

( LANG=C sleep $DELAY ; exec sh -c "exec $COMMAND" ) &
