#!/bin/sh

LANG="de_DE.utf8"
LC_MESSAGES="de_DE.utf8"
PATH="$PATH:/home/daniel/bin:/usr/local/bin:/usr/bin:/bin:/opt/bin:/usr/sbin:/sbin:/usr/games/bin"
XDG_CONFIG_DIRS="/etc/xdg"
XDG_DATA_DIRS="/usr/local/share:/usr/share:/usr/share/gdm"

export MENU_FILE="${HOME}/.fluxbox/_xdgmenu"

# fluxbox-xdg-menu
rm -f "${MENU_FILE}"
xdgmenumaker -f fluxbox -n >"${MENU_FILE}" 2>&1 |
grep -v -e '__init__\.py.*could not open display' \
        -e 'warnings.*_gtk'
true

awk -vFS='[{}]+' '/[exec].*{/ { print $2 }' "${MENU_FILE}" |
while read CMD ARGS ; do
    FULL_CMD="$(which "${CMD}" 2>/dev/null)"

    if ! [ -x "${FULL_CMD}" ] ; then
        sed -i -e "s|.*[exec].*{.*${CMD}.*}.*||" "${MENU_FILE}"
    fi
done
