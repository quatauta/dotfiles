#!/bin/bash
# ~/.config/env
# vim:syntax=sh:

command -v brew 1>/dev/null && eval "$(brew shellenv | grep -v PATH)"

for BIN_DIR in /opt/homebrew/bin \
               "${HOME}/.dotfiles/bin" \
               "${HOME}/.local/bin" \
               "${HOME}/.local/share/mise/shims" \
               "${HOME}/bin" ; do
  [ -e "${BIN_DIR}" ] && export PATH="${BIN_DIR}:${PATH}"
done

[[ -n "${ZSH_PATCHLEVEL}" ]] && typeset -U PATH path

export XDG_CACHE_HOME="${XDG_CACHE_HOME:-${HOME}/.cache}"
export XDG_CONFIG_HOME="${XDG_CONFIG_HOME:-${HOME}/.config}"

export BUNDLE_JOBS="$(nproc || sysctl -n hw.logicalcpu)"
export ELIXIR_ERL_OPTIONS="+sbwt none" # "+P 16777216 +Q 16777216 +K true +A 128 +sbt db +sbwt very_long +swt very_low +sub true +Mulmbcs 32767 +Mumbcgs 1 +Musmbcs 2047 # https://www.erlang.org/doc/man/erl.html
export ERL_AFLAGS="-kernel shell_history_enabled"
export HISTFILE="${XDG_CACHE_HOME}/shell-history"
export HISTSIZE="10000"
export HTML_TIDY="${HOME}/.tidyrc"
export KERL_BUILD_DOCS="true"
export KERL_CONFIGURE_OPTIONS="--disable-debug --disable-silent-rules --enable-shared-zlib --enable-dynamic-ssl-lib --enable-threads --enable-kernel-poll --enable-wx --enable-webview --with-termcap"
export LESS="${LESS} -FMSX"
export MAKEFLAGS="${MAKEFLAGS:--j$(nproc || sysctl -n hw.logicalcpu)}"
export MAKEOPTS="${MAKEOPTS:--j$(nproc || sysctl -n hw.logicalcpu)}"
export MCFLY_INTERFACE_VIEW="BOTTOM"
export RIPGREP_CONFIG_PATH="${HOME}/.config/ripgrep.conf"
export SAVEHIST="${HISTSIZE}"

alias g >/dev/null 2>&1 && type -p g >/dev/null 2>&1 && unalias g >/dev/null 2>&1 ; true
alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'
alias o='less'

if command -v nvim 1>/dev/null ; then
  alias vim='nvim'
  alias vimdiff='nvim -d'
fi

command -v bat  >/dev/null && alias cat='bat' less='bat'
command -v eza  >/dev/null && alias ls='eza'
command -v vim  >/dev/null && alias vi='vim'
command -v vi   >/dev/null && export EDITOR='vi'
command -v vim  >/dev/null && export EDITOR='vim'
command -v nvim >/dev/null && export EDITOR='nvim'
